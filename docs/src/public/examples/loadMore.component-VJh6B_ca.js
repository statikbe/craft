import{D as c}from"./docs-LJADo47n.js";class p{constructor(){document.querySelectorAll("[data-load-more]").forEach(e=>{new d(e)}),c.onDynamicContent(document.documentElement,"[data-load-more]",e=>{e.forEach(r=>{new d(r)})})}}class d{constructor(o){this.element=o,this.infiniteScroll=!1,this.wrapperElement=o,this.pagination=document.getElementById(this.element.getAttribute("data-load-more-pagination")),this.loader=document.getElementById(this.element.getAttribute("data-load-more-loader")),this.trigger=document.getElementById(this.element.getAttribute("data-load-more-trigger")),this.infiniteScroll=this.element.getAttribute("data-load-more-infinite-scroll")==="true",this.wrapperElement&&this.pagination&&this.loader&&this.trigger?this.trigger.addEventListener("click",e=>{e.preventDefault(),this.loadMore()}):console.error("One or more elements are missing in order for the LoadMore component to work"),this.infiniteScroll&&this.initInfiniteScroll()}initInfiniteScroll(){new IntersectionObserver((e,r)=>{e.forEach(t=>{if(t.isIntersecting){const i=this.loadMore();i&&r.unobserve(t.target),i.finally(()=>{r.observe(t.target)})}})},{rootMargin:"10% 0% 10% 0%",threshold:[0,.5,1]}).observe(this.pagination)}async loadMore(){var e,r;const o=this.trigger.getAttribute("href");this.loader.classList.remove("hidden"),this.trigger.classList.add("hidden");try{const t=await fetch(o,{method:"GET"});if(!t.ok){console.log("Something went wrong when fetching data");return}const i=await t.text(),s=new DOMParser().parseFromString(i,"text/html"),a=(e=s.querySelector(`[data-load-more="${this.wrapperElement.getAttribute("data-load-more")}"]`))==null?void 0:e.children;Array.from(a).forEach(n=>{this.wrapperElement.appendChild(n)});const l=s.getElementById(this.trigger.id);if(l){const n=l.href;this.trigger.setAttribute("href",n)}else(r=this.pagination.parentElement)==null||r.removeChild(this.pagination),this.wrapperElement.dispatchEvent(new CustomEvent("loadmore.finished"));this.wrapperElement.dispatchEvent(new CustomEvent("loadmore.loaded",{detail:{elements:Array.from(a)}})),this.loader.classList.add("hidden"),this.trigger.classList.remove("hidden")}catch(t){console.log("There was a connection error",t),this.loader.classList.add("hidden"),this.trigger.classList.remove("hidden")}}}export{p as default};
