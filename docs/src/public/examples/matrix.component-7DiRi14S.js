import{D as m}from"./docs-LJADo47n.js";import{F as d}from"./formater-BczQVLTd.js";class u{constructor(){const e=document.querySelectorAll("[data-matrix-add]");Array.from(e).forEach((i,t)=>{new s(i)}),m.onDynamicContent(document.documentElement,"[data-matrix-add]",i=>{Array.from(i).forEach(t=>{new s(t)})})}}class s{constructor(e){if(this.maxRows=-1,this.triggerButton=e,this.template=document.querySelector("#"+e.getAttribute("data-matrix-add")),this.destinationElement=document.querySelector("#"+e.getAttribute("data-matrix-destination")),!this.triggerButton||!this.template||!this.destinationElement){console.log("One or more elements are missing in order for the Matrix component to work");return}const i=e.getAttribute("data-matrix-max");if(i&&(this.maxRows=parseInt(i)),e.getAttribute("data-matrix-show")){const t=e.getAttribute("data-matrix-show").split(",");this.showElements=t.map(r=>document.getElementById(r)).filter(r=>r)}if(e.getAttribute("data-matrix-hide")){const t=e.getAttribute("data-matrix-hide").split(",");this.hideElements=t.map(r=>document.getElementById(r)).filter(r=>r)}this.triggerButton.addEventListener("click",this.addRow.bind(this))}addRow(e){if(e.preventDefault(),this.maxRows>0&&this.destinationElement.children.length>=this.maxRows){console.warn("Maximum number of rows reached");return}let i=this.triggerButton.hasAttribute("data-matrix-index")?parseInt(this.triggerButton.getAttribute("data-matrix-index")):0;i++,this.triggerButton.setAttribute("data-matrix-index",i.toString());const t=d.evaluateJSTemplate(this.template.innerHTML,{index:i}),r=document.createElement("div");r.setAttribute("data-matrix-row",i.toString()),r.innerHTML=t;const n=r.querySelector("[data-remove-row]");n?n.addEventListener("click",o=>{o.preventDefault(),this.triggerButton.removeAttribute("disabled"),r.remove(),this.optionalElementsAction(),this.triggerButton.dispatchEvent(new CustomEvent("matrix.rowRemoved",{bubbles:!0,detail:{index:i,rowElement:r}}))}):console.warn("No remove button found for the matrix row"),this.destinationElement.appendChild(r),this.destinationElement.children.length>=this.maxRows&&(this.triggerButton.setAttribute("disabled","disabled"),this.triggerButton.dispatchEvent(new CustomEvent("matrix.maxRowsReached",{bubbles:!0,detail:{maxRows:this.maxRows,currentRows:this.destinationElement.children.length}}))),this.optionalElementsAction(),this.triggerButton.dispatchEvent(new CustomEvent("matrix.rowAdded",{bubbles:!0,detail:{index:i,rowElement:r}}))}optionalElementsAction(){var e,i,t,r;this.destinationElement.children.length>0?((e=this.showElements)==null||e.forEach(n=>{n.setAttribute("open",""),this.disableAllFormElements(n),this.triggerButton.dispatchEvent(new CustomEvent("matrix.showElement",{bubbles:!0,detail:{element:n}}))}),(i=this.hideElements)==null||i.forEach(n=>{n.removeAttribute("open"),this.disableAllFormElements(n),this.triggerButton.dispatchEvent(new CustomEvent("matrix.hideElement",{bubbles:!0,detail:{element:n}}))})):((t=this.showElements)==null||t.forEach(n=>{n.removeAttribute("open"),this.disableAllFormElements(n),this.triggerButton.dispatchEvent(new CustomEvent("matrix.hideElement",{bubbles:!0,detail:{element:n}}))}),(r=this.hideElements)==null||r.forEach(n=>{n.setAttribute("open",""),this.disableAllFormElements(n),this.triggerButton.dispatchEvent(new CustomEvent("matrix.showElement",{bubbles:!0,detail:{element:n}}))}))}disableAllFormElements(e){const i=e.querySelectorAll("input, textarea, select");Array.from(i).forEach(t=>{e.hasAttribute("open")?(t.hasAttribute("data-has-required")&&(t.setAttribute("required","required"),t.removeAttribute("data-has-required")),t.removeAttribute("disabled")):(t.hasAttribute("required")&&(t.removeAttribute("required"),t.setAttribute("data-has-required","true")),t.setAttribute("disabled","disabled"))})}}export{u as default};
