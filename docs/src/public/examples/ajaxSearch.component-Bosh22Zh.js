import{D as u,_ as l}from"./docs-LJADo47n.js";import{A as c}from"./ajax-BnX9PgEQ.js";import{S as m}from"./site-lang-Bijq8_jq.js";import{F as d}from"./formater-BczQVLTd.js";import{c as p,s as x}from"./floating-ui.dom-Bhj1bJbm.js";import{S as E}from"./scroll-D17UXzQf.js";class T{constructor(){document.querySelectorAll("[data-ajax-search], [data-ajax-search-callback]").forEach((e,i)=>{e.tagName==="INPUT"&&!e.hasAttribute("data-ajax-search-initialized")&&(e.setAttribute("data-ajax-search-initialized","true"),new h(e,i))}),u.onDynamicContent(document.documentElement,"[data-ajax-search], [data-ajax-search-callback]",e=>{const i=document.querySelectorAll("[data-ajax-search-initialized]").length;e.forEach((t,s)=>{t.tagName==="INPUT"&&!t.hasAttribute("data-ajax-search-initialized")&&(t.setAttribute("data-ajax-search-initialized","true"),new h(t,i+s))})})}}class h{constructor(e,i){if(this.siteLang=m.getLang(),this.options=[],this.searchCallback="",this.ajaxMethod="GET",this.ajaxQueryName="data",this.dataArray="",this.resultTemplate="",this.resultClasses="",this.noresultTemplate="",this.noresultClasses="",this.groupTemplate="",this.groupClasses="",this.typedTextTemplate="",this.typedTextClasses="",this.noresultText="",this.noTypedOption=!1,this.matchWrapper="mark",this.ajaxLoadResults=!1,this.scrollToResults=!0,this.minimumCharacters=3,this.clearInputOnSelect=!1,this.isDisabled=!1,this.ajaxSearchElementClass="relative",this.ajaxSearchListElementClass="absolute left-0 right-0 z-10 overflow-y-auto top-full",this.ajaxSearchListItemClass="",this.inputElement=e,this.ajaxURL=this.inputElement.getAttribute("data-ajax-search"),this.searchCallback=this.inputElement.getAttribute("data-ajax-search-callback"),this.formElement=this.inputElement.closest("form"),this.siteLang&&typeof this.siteLang=="string")if(/^[a-zA-Z-]+$/.test(this.siteLang))f(`../i18n/s-ajax-search-${this.siteLang}.json`).then(t=>{this.lang=t,this.noresultText=this.lang.nothingFound}).catch(t=>{console.error("Error loading language file:",t)});else throw new Error(`Invalid siteLang value: ${this.siteLang}`);else{const t=this.inputElement.getAttribute("data-ajax-search");try{this.ajaxURL=new URL(t,window.location.origin).toString()}catch{console.error("Invalid or missing data-ajax-search attribute. Please provide a valid URL."),this.ajaxURL=null}}if(this.ajaxURL||this.searchCallback){if(this.ajaxURL&&(this.ajaxMethod=this.inputElement.getAttribute("data-ajax-search-method")!=null?this.inputElement.getAttribute("data-ajax-search-method"):this.ajaxMethod,this.ajaxQueryName=this.inputElement.getAttribute("data-ajax-search-query")!=null?this.inputElement.getAttribute("data-ajax-search-query"):this.ajaxQueryName),this.noresultText=this.inputElement.getAttribute("data-ajax-search-no-result-text")!=null?this.inputElement.getAttribute("data-ajax-search-no-result-text"):this.noresultText,this.inputElement.getAttribute("data-ajax-search-result-template")!=null){const t=document.getElementById(this.inputElement.getAttribute("data-ajax-search-result-template"));this.resultTemplate=t!=null?t.innerHTML:"",t.hasAttribute("class")&&(this.resultClasses=t.getAttribute("class").replace("hidden",""))}if(this.inputElement.getAttribute("data-ajax-search-group-template")!=null){const t=document.getElementById(this.inputElement.getAttribute("data-ajax-search-group-template"));this.groupTemplate=t!=null?t.innerHTML:"",t.hasAttribute("class")&&(this.groupClasses=t.getAttribute("class").replace("hidden",""))}if(this.inputElement.getAttribute("data-ajax-search-typed-text-template")!=null){const t=document.getElementById(this.inputElement.getAttribute("data-ajax-search-typed-text-template"));this.typedTextTemplate=t!=null?t.innerHTML:"",t.hasAttribute("class")&&(this.typedTextClasses=t.getAttribute("class").replace("hidden",""))}if(this.inputElement.getAttribute("data-ajax-search-no-result-template")!=null){const t=document.getElementById(this.inputElement.getAttribute("data-ajax-search-no-result-template"));this.noresultTemplate=t!=null?t.innerHTML:"",t.hasAttribute("class")&&(this.noresultClasses=t.getAttribute("class").replace("hidden",""))}this.inputElement.getAttribute("data-ajax-search-no-typed-option")!=null&&(this.noTypedOption=this.inputElement.getAttribute("data-ajax-search-no-typed-option")==="true"),this.inputElement.getAttribute("data-ajax-search-destination-input")!=null&&(this.destinationInput=document.querySelector(`input[name="${this.inputElement.getAttribute("data-ajax-search-destination-input")}"]`)),this.inputElement.getAttribute("data-ajax-search-clear-on-select")!=null&&(this.clearInputOnSelect=this.inputElement.getAttribute("data-ajax-search-clear-on-select")==="true"),this.ajaxLoadResults&&(this.resultsElement=document.querySelector("[data-ajax-search-results]"),this.loaderAnimationElement=document.querySelector("[data-ajax-search-loader]")),this.dataArray=this.inputElement.getAttribute("data-ajax-search-data"),this.inputElement.hasAttribute("data-ajax-search-list-element-class")&&(this.ajaxSearchListElementClass+=" "+this.inputElement.getAttribute("data-ajax-search-list-element-class")),this.inputElement.hasAttribute("data-ajax-search-list-item-class")&&(this.ajaxSearchListItemClass=this.inputElement.getAttribute("data-ajax-search-list-item-class")),this.inputElement.hasAttribute("data-ajax-search-match-wrapper")&&(this.matchWrapper=this.inputElement.getAttribute("data-ajax-search-match-wrapper")),this.inputElement.removeAttribute("data-ajax-search"),this.inputElement.setAttribute("aria-controls",`ajaxSearchList${i}`),this.inputElement.setAttribute("autocapitalize","none"),this.inputElement.setAttribute("autocomplete","off"),this.inputElement.setAttribute("aria-autocomplete","list"),this.inputElement.setAttribute("aria-expanded","false"),this.isDisabled=this.inputElement.getAttribute("disabled")!=null,this.ajaxSearchElement=document.createElement("div"),this.ajaxSearchElement.classList.add(this.ajaxSearchElementClass),this.isDisabled&&this.ajaxSearchElement.classList.add("disabled"),this.inputElement.insertAdjacentElement("afterend",this.ajaxSearchElement),this.inputKeyUpListener=this.onKeyUp.bind(this),this.inputElement.addEventListener("keyup",this.inputKeyUpListener),this.inputKeyDownListener=this.onKeyDown.bind(this),this.inputElement.addEventListener("keydown",this.inputKeyDownListener),this.inputFocusListener=this.onFocus.bind(this),this.inputElement.addEventListener("focus",this.inputFocusListener),this.ajaxSearchListElement=document.createElement("ul"),this.ajaxSearchListElement.setAttribute("id",`ajaxSearchList${i}`),this.ajaxSearchListElement.setAttribute("role","listbox"),this.ajaxSearchListElement.classList.add(...this.ajaxSearchListElementClass.split(" ")),this.ajaxSearchListElement.classList.add("hidden"),this.ajaxSearchElement.insertAdjacentElement("beforeend",this.ajaxSearchListElement),this.statusElement=document.createElement("div"),this.statusElement.setAttribute("aria-live","polite"),this.statusElement.setAttribute("role","status"),this.statusElement.classList.add("sr-only"),this.ajaxSearchElement.insertAdjacentElement("beforeend",this.statusElement),this.documentClickListener=this.onDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener)}else console.error("No URL defined to make the ajax call for the search. Make sure you give the attribute data-ajax-search a value!")}onKeyUp(e){switch(e.key){case"ArrowLeft":case"ArrowRight":case" ":case"Shift":break;case"Escape":this.hideMenu();break;case"Enter":if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.hoverOption){const i=this.hoverOption.querySelector("a");i&&i.click();const t=this.hoverOption.querySelector("button");t&&t.click(),this.destinationInput&&(this.destinationInput.value=this.hoverOption.getAttribute("data-value"),this.destinationInput.dispatchEvent(new Event("jschange")),this.inputElement.value=this.hoverOption.innerText.trim(),this.hideMenu()),this.clear()}break;case"ArrowUp":if(e.preventDefault(),this.hoverOption){let i=this.hoverOption.previousElementSibling;this.hoverOption&&i?this.highlightOption(i):this.highlightOption(this.ajaxSearchListElement.lastChild)}else this.highlightOption(this.ajaxSearchListElement.lastChild);break;case"ArrowDown":if(e.preventDefault(),this.ajaxSearchListElement.classList.contains("hidden")&&this.options.length>0)this.onTextBoxDownPressed(e);else if(this.hoverOption){let i=this.hoverOption.nextElementSibling;this.hoverOption&&i?this.highlightOption(i):this.highlightOption(this.ajaxSearchListElement.firstChild)}else this.highlightOption(this.ajaxSearchListElement.firstChild);break;default:this.inDebounce&&clearInterval(this.inDebounce),this.inDebounce=setTimeout(()=>{this.onTextBoxType(e)},300)}}onKeyDown(e){switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();break;case"Tab":this.hideMenu();break}}onFocus(e){this.inputElement.value.trim().length>0&&(this.searchCallback?window[this.searchCallback](this.inputElement.value.trim().toLowerCase()).then(i=>{this.showData(i)}):this.getData(this.inputElement.value.trim().toLowerCase()))}onDocumentClick(e){this.ajaxSearchElement.contains(e.target)?this.clear():this.hideMenu()}onTextBoxType(e){if(this.inputElement.value.trim().length>=this.minimumCharacters)if(this.searchCallback)if(typeof window[this.searchCallback]=="function"){const i=window[this.searchCallback](this.inputElement.value.trim().toLowerCase());i instanceof Promise?i.then(t=>{this.showData(t)}).catch(t=>{console.error("Error in search callback promise:",t)}):console.error("The search callback did not return a promise.")}else console.error(`The search callback "${this.searchCallback}" is not defined or is not a function.`);else this.getData(this.inputElement.value.trim().toLowerCase());else this.hideMenu(),this.destinationInput&&(this.destinationInput.value="",this.destinationInput.dispatchEvent(new Event("jschange")))}onTextBoxDownPressed(e){this.showMenu(),this.options.length>0&&this.highlightOption(this.options[0])}showMenu(){this.ajaxSearchListElement.classList.remove("hidden"),this.inputElement.setAttribute("aria-expanded","true"),this.inputElement.dispatchEvent(new CustomEvent("ajaxSearchShowMenu",{bubbles:!0})),this.positionMenu()}hideMenu(){this.ajaxSearchListElement.classList.add("hidden"),this.inputElement.setAttribute("aria-expanded","false"),this.inputElement.removeAttribute("aria-activedescendant"),this.inputElement.dispatchEvent(new CustomEvent("ajaxSearchHideMenu",{bubbles:!0}))}positionMenu(){const e=this;p(this.ajaxSearchElement,this.ajaxSearchListElement,{placement:"bottom-start",middleware:[x({apply({availableWidth:i,availableHeight:t,elements:s}){Object.assign(s.floating.style,{maxWidth:`${i}px`,maxHeight:`${t}px`})}})]}).then(({x:i,y:t})=>{Object.assign(e.ajaxSearchListElement.style,{left:`${i}px`,top:`${t}px`})})}getData(e,i=null){if(this.xhr&&this.xhr.abort(),!this.ajaxURL||typeof this.ajaxURL!="string"||!this.ajaxURL.trim()){console.error("Invalid or missing ajaxURL. Please provide a valid URL.");return}let t=null,s=this.ajaxURL;this.ajaxMethod=="GET"&&(this.ajaxQueryName===""?s+=e:s.indexOf("?")<0?s+=`?${this.ajaxQueryName}=${encodeURIComponent(e)}`:s+=`&${this.ajaxQueryName}=${encodeURIComponent(e)}`),this.ajaxMethod=="POST"&&(t={},t[this.ajaxQueryName]=e),this.xhr=c.call({url:s,data:t,method:this.ajaxMethod,xhr:this.xhr,success:a=>{Array.isArray(a)||(a=[a]),this.showData(a)},error:a=>{console.error(a),this.showData(null)}})}showData(e){if(this.ajaxSearchListElement.innerHTML="",this.dataArray&&this.dataArray.split(".").forEach(i=>{e&&(e=e[i])}),e&&(e.forEach(i=>{i.group?(this.addDataToList(i.group,this.groupTemplate,this.groupClasses),i.data.forEach(t=>{this.addDataToList(t,this.resultTemplate,this.resultClasses)})):this.addDataToList(i,this.resultTemplate,this.resultClasses)}),this.updateStatus(e.length)),!e||e.length==0){const i=document.createElement("li");if(i.setAttribute("role","option"),this.noresultClasses.length>0){const t=this.noresultClasses.trim().split(" ");t.length>0&&i.classList.add(...t)}this.noresultTemplate==""?i.innerText=this.noresultText:i.innerHTML=this.noresultTemplate,this.ajaxSearchListElement.insertAdjacentElement("beforeend",i)}if(!this.noTypedOption){const i=document.createElement("li");if(i.setAttribute("role","option"),this.ajaxSearchListItemClass.length>0&&this.typedTextClasses.length==0){const a=this.ajaxSearchListItemClass.trim().split(" ");a.length>0&&i.classList.add(...a)}if(this.typedTextClasses.length>0){const a=this.typedTextClasses.trim().split(" ");a.length>0&&i.classList.add(...a)}let t=this.typedTextTemplate;if(t){const a=this.typedTextTemplate.match(/%%(.*)%%/gi);a&&a.forEach(n=>{t=t.replace(n,this.inputElement.value.trim())})}else t=`${this.lang.showResultsForQuery} ${this.inputElement.value.trim()}`;const s=document.createElement("a");s.href=this.formElement.action+"?"+this.inputElement.name+"="+this.inputElement.value.trim().toLowerCase(),s.insertAdjacentHTML("afterbegin",t),this.ajaxLoadResults&&(s.addEventListener("click",a=>{a.preventDefault(),this.getResultsData(s.href),this.hideMenu()}),this.formElement.addEventListener("submit",a=>{a.preventDefault(),this.getResultsData(s.href),this.hideMenu()})),i.insertAdjacentElement("afterbegin",s),this.ajaxSearchListElement.insertAdjacentElement("beforeend",i)}this.showMenu()}addDataToList(e,i,t=""){const s=document.createElement("li");if(s.setAttribute("role","option"),this.ajaxSearchListItemClass.length>0&&t.length==0){const n=this.ajaxSearchListItemClass.trim().split(" ");n.length>0&&s.classList.add(...n)}if(t.length>0){const n=t.trim().split(" ");n.length>0&&s.classList.add(...n)}if(i==""?s.innerText=e:s.innerHTML=d.parseTemplate(i,e),this.inputElement.value.trim()&&this.matchWrapper.length>0){const n=this.inputElement.value.trim(),o=new RegExp(`(${encodeURIComponent(n)})`,"gi");s.innerHTML=s.innerHTML.replace(o,`<${this.matchWrapper}>$1</${this.matchWrapper}>`)}const a=s.querySelector("a");a&&a.setAttribute("tabindex","-1"),this.destinationInput&&(s.setAttribute("data-value",e[this.inputElement.getAttribute("data-ajax-search-destination-value")]),s.addEventListener("click",n=>{this.destinationInput.value=e[this.inputElement.getAttribute("data-ajax-search-destination-value")],this.inputElement.value=s.innerText,this.destinationInput.dispatchEvent(new Event("jschange")),this.hideMenu()})),this.ajaxSearchListElement.insertAdjacentElement("beforeend",s)}updateStatus(e){this.statusElement&&(this.statusElement.innerText=`${e} ${this.lang.resultsAvailable}`)}highlightOption(e){this.hoverOption&&this.hoverOption.removeAttribute("aria-selected"),e&&(e.setAttribute("aria-selected","true"),this.ajaxSearchListElement.scrollTop=e.offsetTop,this.inputElement.setAttribute("aria-activedescendant",e.id)),this.hoverOption=e}getResultsData(e){const i=this;this.xhrResults&&this.xhrResults.abort(),this.xhrResults=new XMLHttpRequest,this.xhrResults.open("GET",e,!0),this.showLoading(),this.xhrResults.onload=function(){if(this.status>=200&&this.status<400){if(!this.response||typeof this.response!="string"){console.error("Invalid response received.");return}const t=document.implementation.createHTMLDocument("");t.body.innerHTML=this.response;const s=t.querySelector("[data-ajax-search-results]");s?(i.resultsElement.innerHTML=s.innerHTML,history.pushState("","New URL: "+e,e),i.hideLoading(),i.scrollToResults&&E.scrollToY(i.resultsElement,500)):console.error("Could not find data on returned page.")}else console.error("Something went wrong when fetching data.")},this.xhrResults.onerror=function(){console.error("There was a connection error.")},this.xhrResults.send()}showLoading(){this.loaderAnimationElement&&(this.loaderAnimationElement.classList.remove("hidden"),this.resultsElement.classList.add("hidden"))}hideLoading(){this.loaderAnimationElement&&(this.loaderAnimationElement.classList.add("hidden"),this.resultsElement.classList.remove("hidden"))}clear(){this.clearInputOnSelect&&(this.inputElement.value="",this.hideMenu())}}function f(r){switch(r){case"../i18n/s-ajax-search-en":case"../i18n/s-ajax-search-en.json":return l(()=>import("./s-ajax-search-en-Cs7dR_Aa.js"),[]);case"../i18n/s-ajax-search-fr":case"../i18n/s-ajax-search-fr.json":return l(()=>import("./s-ajax-search-fr-Ckgkd63-.js"),[]);case"../i18n/s-ajax-search-nl":case"../i18n/s-ajax-search-nl.json":return l(()=>import("./s-ajax-search-nl-BQRr2Lkr.js"),[]);default:return new Promise(function(e,i){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+r)))})}}export{T as default};
