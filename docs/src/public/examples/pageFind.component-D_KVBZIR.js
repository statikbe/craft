class d{constructor(){}static debounce(e,s){let t;return function(){const i=this,n=arguments;clearTimeout(t),t=setTimeout(()=>e.apply(i,n),s)}}}class a{constructor(){this.searchText="",this.highlights=[],this.previousKey="",this.currentIndex=1,this.searchTotal=0,this.options={highlightClasses:["bg-yellow-500"],currentHighlightClasses:["bg-red-500"]};const e=document.querySelector("form.js-find-form");e&&this.initFind(e),Array.from(document.querySelectorAll("p.hidden")).forEach(s=>{s.addEventListener("show",()=>{s.classList.remove("hidden")})})}initFind(e){this.inputElement=document.querySelector(".js-find-input"),this.resultsElement=document.querySelector(".js-page-find-results"),this.nextElement=document.querySelector(".js-page-find-next"),this.previousElement=document.querySelector(".js-page-find-prev"),this.clearElement=document.querySelector(".js-page-find-clear"),this.currentElement=this.resultsElement.querySelector(".js-current-find"),this.totalElement=this.resultsElement.querySelector(".js-total-find");const s=e.getAttribute("data-s-search-block");s?(this.searchElement=document.querySelector(`#${s}`),this.searchElement&&(this.searchText=this.searchElement.textContent)):(this.searchElement=document.body,this.searchText=document.body.textContent),this.resultsElement.classList.add("hidden"),this.inputElement.addEventListener("keyup",t=>{if(t.key==="Enter"&&this.previousKey!=="Enter")this.onFind(t);else{if(t.key==="Enter"&&this.previousKey==="Enter")return;d.debounce(i=>{this.onFind(i),this.previousKey="Enter"},500)()}this.previousKey=t.key}),this.nextElement.addEventListener("click",this.gotoNext.bind(this)),this.previousElement.addEventListener("click",this.gotoPrev.bind(this)),this.clearElement.addEventListener("click",this.onClear.bind(this)),e.addEventListener("submit",t=>{t.preventDefault(),this.gotoNext()})}onFind(e){if(this.clearHighlights(),!this.searchText.toLowerCase().includes(this.inputElement.value.toLowerCase())||this.inputElement.value.trim().length==0)return this.resultsElement.classList.add("hidden"),!1;let t=this.inputElement.value;t=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.searchTotal=(this.searchText.match(new RegExp(t,"gi"))||[]).length,this.resultsElement.classList.remove("hidden"),this.totalElement.innerText=`${this.searchTotal}`,this.currentElement.innerText="1",this.currentIndex=1,this.highlightWord(this.inputElement.value),this.scrollToQuery(this.highlights[this.currentIndex-1])}highlightWord(e,s){s||(s=this.searchElement);for(let t=s.firstChild;t;t=t.nextSibling)if(t.nodeType==3){let i=t,n=0;if(n=i.nodeValue.toLowerCase().indexOf(e.toLowerCase()),n>-1){let r=i.nodeValue.substr(0,n),o=i.nodeValue.substr(n,e.length),h=document.createTextNode(i.nodeValue.substr(n+e.length)),l=document.createElement("span");l.classList.add(...this.options.highlightClasses),l.appendChild(document.createTextNode(o)),i.nodeValue=r,i.parentNode.insertBefore(h,i.nextSibling),i.parentNode.insertBefore(l,i.nextSibling),this.highlights.push(l),l.id="highlight_span"+this.highlights.length,t=t.nextSibling}}else t.nodeType==1&&this.highlightWord(e,t)}clearHighlights(){this.highlights.forEach(e=>{const s=e.parentNode;e.outerHTML=e.innerText,s.normalize()}),this.highlights=[]}onClear(){this.clearHighlights(),this.inputElement.value="",this.resultsElement.classList.add("hidden")}gotoNext(){this.highlights.length>0&&(this.highlights[this.currentIndex-1].classList.add(...this.options.highlightClasses),this.highlights[this.currentIndex-1].classList.remove(...this.options.currentHighlightClasses),this.currentIndex++,this.currentIndex>this.searchTotal&&(this.currentIndex=1),this.currentElement.innerText=`${this.currentIndex}`,this.scrollToQuery(this.highlights[this.currentIndex-1]))}gotoPrev(){this.highlights.length>0&&(this.highlights[this.currentIndex-1].classList.add(...this.options.highlightClasses),this.highlights[this.currentIndex-1].classList.remove(...this.options.currentHighlightClasses),this.currentIndex--,this.currentIndex<1&&(this.currentIndex=this.searchTotal),this.currentElement.innerText=`${this.currentIndex}`,this.scrollToQuery(this.highlights[this.currentIndex-1]))}scrollToQuery(e){if(!e)return;const s=this.isElementHidden(e);if(s){let h;typeof Event=="function"?h=new Event("show"):(h=document.createEvent("Event"),h.initEvent("show",!0,!0)),console.log("trigger",s),s.dispatchEvent(h)}const t=e.closest(".js-open-on-find");t&&t.dispatchEvent(new Event("open")),e.classList.add(...this.options.currentHighlightClasses),e.classList.remove(...this.options.highlightClasses);const i=window.pageYOffset||document.documentElement.scrollTop,n=window.innerHeight,r=e.getBoundingClientRect().top,o=e.getBoundingClientRect().height;(r+o>n||r<0)&&window.scrollTo(0,r+i-n/2)}isElementHidden(e){return e?window.getComputedStyle(e).display==="none"||e.hasAttribute("data-s-toggle")&&!e.classList.contains("expanded")?e:e.parentElement?this.isElementHidden(e.parentElement):!1:!1}}export{a as default};
